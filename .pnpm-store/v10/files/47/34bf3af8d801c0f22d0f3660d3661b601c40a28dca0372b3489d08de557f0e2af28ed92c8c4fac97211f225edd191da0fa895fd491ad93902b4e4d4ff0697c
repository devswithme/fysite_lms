{"version":3,"sources":["../../../src/transform/write/index.ts"],"sourcesContent":["import type { FlattenedField } from 'payload'\n\nimport type { DrizzleAdapter } from '../../types.js'\nimport type { RowToInsert } from './types.js'\n\nimport { traverseFields } from './traverseFields.js'\n\ntype Args = {\n  adapter: DrizzleAdapter\n  data: Record<string, unknown>\n  enableAtomicWrites?: boolean\n  fields: FlattenedField[]\n  parentIsLocalized?: boolean\n  path?: string\n  tableName: string\n}\n\nexport const transformForWrite = ({\n  adapter,\n  data,\n  enableAtomicWrites,\n  fields,\n  parentIsLocalized,\n  path = '',\n  tableName,\n}: Args): RowToInsert => {\n  // Split out the incoming data into rows to insert / delete\n  const rowToInsert: RowToInsert = {\n    arrays: {},\n    blocks: {},\n    blocksToDelete: new Set(),\n    locales: {},\n    numbers: [],\n    numbersToDelete: [],\n    relationships: [],\n    relationshipsToDelete: [],\n    row: {},\n    selects: {},\n    texts: [],\n    textsToDelete: [],\n  }\n\n  // This function is responsible for building up the\n  // above rowToInsert\n  traverseFields({\n    adapter,\n    arrays: rowToInsert.arrays,\n    baseTableName: tableName,\n    blocks: rowToInsert.blocks,\n    blocksToDelete: rowToInsert.blocksToDelete,\n    columnPrefix: '',\n    data,\n    enableAtomicWrites,\n    fieldPrefix: '',\n    fields,\n    locales: rowToInsert.locales,\n    numbers: rowToInsert.numbers,\n    numbersToDelete: rowToInsert.numbersToDelete,\n    parentIsLocalized,\n    parentTableName: tableName,\n    path,\n    relationships: rowToInsert.relationships,\n    relationshipsToDelete: rowToInsert.relationshipsToDelete,\n    row: rowToInsert.row,\n    selects: rowToInsert.selects,\n    texts: rowToInsert.texts,\n    textsToDelete: rowToInsert.textsToDelete,\n  })\n\n  return rowToInsert\n}\n"],"names":["traverseFields","transformForWrite","adapter","data","enableAtomicWrites","fields","parentIsLocalized","path","tableName","rowToInsert","arrays","blocks","blocksToDelete","Set","locales","numbers","numbersToDelete","relationships","relationshipsToDelete","row","selects","texts","textsToDelete","baseTableName","columnPrefix","fieldPrefix","parentTableName"],"mappings":"AAKA,SAASA,cAAc,QAAQ,sBAAqB;AAYpD,OAAO,MAAMC,oBAAoB,CAAC,EAChCC,OAAO,EACPC,IAAI,EACJC,kBAAkB,EAClBC,MAAM,EACNC,iBAAiB,EACjBC,OAAO,EAAE,EACTC,SAAS,EACJ;IACL,2DAA2D;IAC3D,MAAMC,cAA2B;QAC/BC,QAAQ,CAAC;QACTC,QAAQ,CAAC;QACTC,gBAAgB,IAAIC;QACpBC,SAAS,CAAC;QACVC,SAAS,EAAE;QACXC,iBAAiB,EAAE;QACnBC,eAAe,EAAE;QACjBC,uBAAuB,EAAE;QACzBC,KAAK,CAAC;QACNC,SAAS,CAAC;QACVC,OAAO,EAAE;QACTC,eAAe,EAAE;IACnB;IAEA,mDAAmD;IACnD,oBAAoB;IACpBtB,eAAe;QACbE;QACAQ,QAAQD,YAAYC,MAAM;QAC1Ba,eAAef;QACfG,QAAQF,YAAYE,MAAM;QAC1BC,gBAAgBH,YAAYG,cAAc;QAC1CY,cAAc;QACdrB;QACAC;QACAqB,aAAa;QACbpB;QACAS,SAASL,YAAYK,OAAO;QAC5BC,SAASN,YAAYM,OAAO;QAC5BC,iBAAiBP,YAAYO,eAAe;QAC5CV;QACAoB,iBAAiBlB;QACjBD;QACAU,eAAeR,YAAYQ,aAAa;QACxCC,uBAAuBT,YAAYS,qBAAqB;QACxDC,KAAKV,YAAYU,GAAG;QACpBC,SAASX,YAAYW,OAAO;QAC5BC,OAAOZ,YAAYY,KAAK;QACxBC,eAAeb,YAAYa,aAAa;IAC1C;IAEA,OAAOb;AACT,EAAC"}